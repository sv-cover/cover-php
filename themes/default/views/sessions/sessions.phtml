<h2><?= markup_format_text(sprintf(__('Sessies van %s'), $member->get('voornaam'))) ?></h2>

<?php if ($this->user_can_override_stuff()): ?>
<div class="messageBox">
	<form method="post" action="sessions.php?view=overrides" class="vertical-form">
		<fieldset>
			<legend>
				<?=input_checkbox('override_committees', ['override_committees' => get_identity()->get_override_committees() !== null])?>
				<?=label(__('Overschrijf commissielidmaatschappen'), 'override_committees') ?>
			</legend>
			
			<label><?=__('Commissies')?></label>
			<ul class="option-group">
				<?php foreach (get_model('DataModelCommissie')->get() as $committee): ?>
				<li>
					<?=input_checkbox('override_committee_ids[]', ['override_committee_ids' => get_identity()->get_override_committees()], $committee->get_id(), 'id', 'field-override-committee-' . $committee->get_id())?>
					<?=label($committee->get('naam'), 'override-committee-' . $committee->get_id())?>
				</li>
				<?php endforeach ?>
			</ul>
		</fieldset>

		<fieldset>
			<legend>
				<?=input_checkbox('override_member', ['override_member' => get_identity()->get_override_member() !== null])?>
				<?=label(__('Overschrijf lidnummer'), 'override_member') ?>
			</legend>

			<div>
				<?=label(__('Lidnummer'), 'override_member_id')?>
				<?=input_text('override_member_id', ['override_member_id' => get_identity()->get_override_member() ? get_identity()->get_override_member()->get_id() : null]) ?>
			</div>
		</fieldset>

		<button type="submit" class="button"><?=__('Stel in')?></button>
	</form>
</div>
<script>
$('fieldset').each(function(i, fieldset) {
	var masterSwitch = $(fieldset).find('legend input[type=checkbox]');

	var toggles = $(fieldset).find('input').not(masterSwitch);

	var update = function() {
		toggles.prop('disabled', !masterSwitch.is(':checked'));
	};

	update();

	masterSwitch.on('change', update);
});
</script>
<?php endif ?>

<div class="messageBox">
	<form method="post" action="sessions.php?view=sessions">
		<table class="sessions-table">
			<thead>
				<tr>
					<th>&nbsp;</th>
					<th><?= __('IP-adres') ?></th>
					<th><?= __('Applicatie') ?></th>
					<th><?= __('Ingelogd') ?></th>
					<th><?= __('Laatst actief') ?></th>
				</tr>
			</thead>
			<tbody>
				<?php foreach ($iter as $session): ?>
				<tr>
					<td><input type="checkbox" name="sessions[]" value="<?=$session->get_id()?>"></td>
					<td><?=$session->get('ip_address')?></td>
					<td><?=$this->format_application($session->get('application'))?></td>
					<td><?=$this->format_time($session->get('created_on'))?></td>
					<td><?=$this->format_time($session->get('last_active_on'))?></td>
				</tr>
				<?php endforeach ?>
			</tbody>
		</table>
		<input type="submit" class="button" name="destroy" value="<?= __('Sluit geselecteerde sessies') ?>">
	</form>
</div>
