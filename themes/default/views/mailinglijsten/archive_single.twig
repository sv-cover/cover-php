{% extends '@layout/layout.twig' %}

{% block title message.subject ~ ' :: ' ~ list.naam ~ ' :: ' ~ parent() %}

{% block content %}

<header>
	<nav class="breadcrumb" aria-label="breadcrumbs">
		<ul>
			<li><a href="{{ controller.link_to_index()|e('html_attr') }}">{{ __('Mailing lists') }}</a></li>
			<li><a href="{{ controller.link_to_read(list)|e('html_attr') }}">{{ list.naam }}</a></li>
			<li class="is-active"><a href="{{ link_to('archive_index', list)|e('html_attr') }}">{{ __('Archived messages') }}</a></li>
		</ul>
	</nav>
	<div class="content">
		<p>
			{# TODO: clean this upâ€¦ #}
			{{ __('Message from the archive of %s, processed on %s (return code %s)')|e('html')|format('<a href="%s">%s</a>'|format(controller.link_to_read(list)|e('html_attr'), list.naam|e('html'))|raw, message.verwerkt_op|date(), message.return_code)|raw }}
		</p>
	</div>
</header>

<article>
	{% if error %}
		<div class="content">
			<p>Could not parse message due to the following error</p>
			<p>{{error}}</p>
		</div>
	{% else %}
		{% if subject is not null %}
			<h1 class="title">{{ subject }}</h1>
		{% endif %}
		<div class="tabs-wrapper">
			<div class="tabs is-toggle">
				<ul>
					{% if html_body is not null %}
						<li><a href="#email-html-body">{{ __('Formatted') }}</a></li>
					{% endif %}
					{% if text_body is not null %}
						<li><a href="#email-text-body">{{ __('Plain text') }}</a></li>
					{% endif %}
					<li><a href="#email-raw">Raw</a></li>
				</ul>
			</div>

			<div class="tabs-content">
				<div id="email-html-body">
					<iframe sandbox="allow-same-origin allow-popups allow-popups-to-escape-sandbox" target="_blank" srcdoc="{{html_body|e('html_attr')}}" style="width: 100%; height: 400px; border: 1px solid #ccc; background: #fff" onload="makeLegible(this)"></iframe>
					<script>
						function makeLegible(iframe) {
							// "inherit" the font
							var doc = iframe.contentWindow.document;
							doc.body.style.font = getComputedStyle(iframe.parentNode).font;

							// Make sure links open in new windows
							var base = doc.createElement('base');
							base.target = '_blank';
							doc.head.appendChild(base);
						}
					</script>
				</div>
				<div id="email-text-body">
					<pre style="white-space: pre-wrap; 
						white-space: -moz-pre-wrap; 
						white-space: -pre-wrap; 
						white-space: -o-pre-wrap; 
						word-wrap: break-word;">{{ text_body }}</pre>
				</div>
				<div id="email-raw">	
					<pre style="white-space: pre-wrap; 
						white-space: -moz-pre-wrap; 
						white-space: -pre-wrap; 
						white-space: -o-pre-wrap; 
						word-wrap: break-word;">{{ message.bericht }}</pre>
				</div>
			</div>
		</div>
	{% endif %}
</article>

{% endblock %}