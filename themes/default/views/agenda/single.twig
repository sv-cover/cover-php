{% extends '@layout/layout.twig' %}

{% block content %}
{% if iter.is_proposal %}
	<div class="notification is-danger">
		{% if iter.replacement_for == 0 %}
			<p >{{ __('This activity has not yet been published. It still needs to be accepted by the Board.') }}</p>
		{% else %}
			<p>{{ __('This revision of the activity has not yet been published.') }}</p>
		{% endif %}
	</div>
{% endif %}

{% if mutation %}
	<div class="notification is-danger">
		<p>{{ __('There is <a href="%s">a change on this activity</a> that is not yet published.')|format(mutation.get_absolute_url()|e('html'))|raw }}</p>
	</div>
{% endif %}

<header>
	
	<!-- Event name -->
	<div class="level">
		<div class="level-left">
			<h1 class="title">
				<!-- Calendar icon -->
				<span class="calendar-icon">
					<span class="month">{{ iter.van|date('M') }}</span>
					<span class="day">{{ iter.van|date('d') }}</span>{# Ew… No space after this thing…
				 #}</span>:
				{{ iter.kop }}
			</h1>
		</div>
		<div class="level-right">
			<div class="field is-grouped">
				<div class="control">
					<a href="https://www.facebook.com/events/{{ iter.facebook_id }}/" target="_blank" class="button" title="{{  __('Show on Facebook') }}">
						<span class="icon">
							<i class="fab fa-facebook-square" aria-hidden="true"></i>
							<span class="is-sr-only">{{  __('Show on Facebook') }}</span>
						</span>
					</a>
				</div>
				<div class="control">
					<a href="agenda.php" class="button">{{  __('Complete calendar') }}</a>
				</div>

				{% if user_can_create iter.new_signup_form %}
				<div class="control">
					<a href="signup.php?view=create_form&amp;agenda={{iter.id}}" class="button">{{ __('New sign-up form') }}</a>
				</div>
				{% endif %}

				{% if user_can_delete iter %}
					<div class="control">
						<a href="{{ controller.link_to_delete(iter) }}" class="button" title="{{  __('Delete event') }}">
							<span class="icon">
								<i class="fas fa-trash" aria-hidden="true"></i>
								<span class="is-sr-only">{{  __('Delete event') }}</span>
							</span>
						</a>
					</div>
				{% endif %}
				{% if user_can_update iter %}
					<div class="control">
						<a href="{{ controller.link_to_update(iter) }}" class="button" title="{{  __('Modify event') }}">
							<span class="icon">
								<i class="fas fa-pencil-alt" aria-hidden="true"></i>
								<span class="is-sr-only">{{  __('Modify event') }}</span>
							</span>
						</a>
					</div>
				{% endif %}
		</div>
	</div>


{# 	<!-- Facebook Cover photo (or fallback photo) -->
	{% set cover_photo = view.cover_photo(iter) %}
	{% if cover_photo %}
	<div class="event-cover-photo">
		<!-- On Facebook this image is shown in an 784x295 area -->
		<div style="{{ 'left: -%0.2F%%; top: -%0.2F%%'|format(cover_photo.x, cover_photo.y) }}">
			<img src="{{ cover_photo.src }}" style="position: absolute; left: 0; right:0; top:0">
		</div>
	</div>
	{% endif %}


	<!-- Facebook attendees -->
	{% set attendees = view.attendees(iter) %}
	{% if attendees %}
	<ul class="event-attendees inline-profile-list">
	{% for attendee in attendees %}
		<li>
			<a href="https://facebook.com/{{ attendee.id }}" target="_new">
				<img src="https://graph.facebook.com/{{ attendee.id }}/picture/?width=100&amp;height=100">
				<span class="name">{{ attendee.name }}</span>
			</a>
		</li>
	{% endfor %}
	</ul>
	{% endif %}

	<!-- Facebook RSVP status -->
	{% if get_config_value('enable_facebook_rsvp', false) %}
		{% set rsvp_status = view.rsvp_status(iter) %}
		{% if rsvp_status %}
		<div class="rsvp-status-button dropdown-button">
			<span class="current button" tabindex="0">{{ view.rsvp_status_text(rsvp_status) }}</span>
			<form method="post">
				<input type="hidden" name="agenda_id" value="{{ iter.id }}">
				<ul class="dropdown-menu">
					<li><button type="submit" name="rsvp_status" value="attending">{{ __('Going') }}</button></li>
					<li><button type="submit" name="rsvp_status" value="maybe">{{ __('Maybe') }}</button></li>
					<li><button type="submit" name="rsvp_status" value="declined">{{ __('Not going') }}</button></li>
				</ul>
			</form>
		</div>
		{% elseif iter.facebook_id %}
		<div class="rsvp-status-button">
			<a href="{{ view.facebook.coverLoginURL }}" class="button">{{ __('Connect to Facebook') }}</a>
		</div>
		{% endif %}
	{% elseif get_config_value('enable_facebook', false) and iter.facebook_id %}
	<div class="rsvp-status-button">
		<a href="https://www.facebook.com/events/{{ iter.facebook_id }}/" target="_blank" class="button">{{ __('Show on Facebook') }}</a>
	</div>
	{% endif %} #}
</header>

<!-- Actual event -->
<article>
	<div class="content">
		<p>{{  __('Date & time') }}: {{  iter|period }}<br>
		{% if iter.locatie %}
			{{  __('Location') }}: {{ iter.locatie }}<br>
		{% endif %}
		</p>
		
		<!-- If the event is organised externally, add a clear notice to it -->
		{% if iter.extern %}
			<p class="has-text-danger">{{  __('This activity is not organised by Cover.') }}</p>
		{% endif %}

		<!-- Formatted description of the event -->
		<p>{{ iter.beschrijving|parse_markup }}</p>

		<!-- Some meta-data -->
		{% if iter.committee %}
		<p><small>{{  __('Placed by') }}: <a href="commissies.php?commissie={{ iter.committee.login }}">{{ iter.committee.naam }}</a></small></p>
		{% endif %}
	</div>

	{% if iter.signup_forms %}
		{% if global.auth.logged_in %}
			{% for form in iter.signup_forms %}
				{% if user_can_read form %}
					{{ include('signup_form.twig', {form: form}) }}
				{% endif %}
			{% endfor %}
		{% else %}
			<div class="box content">
				<p>{{ __('Your registrion will be linked to your account, so you need to login to register for this activity. ') }}</p>
				<p>
					{{ 
						__(
							'If you\'re not a member and still want to join, that might be possible. Contact the %s for more information.'
						)|e('html')|format(
							'<a href="mailto:%s@svcover.nl">%s</a>'|format(iter.committee.login|e('html'), iter.committee.naam|e('html'))
						)|raw
					}}
				</p>
				<a href="sessions.php?view=login&amp;referrer=agenda.php%3Fagenda_id={{ iter.id }}" class="button is-primary">{{ __('Log in') }}</a>
			</div>
		{% endif %}
	{% endif %}
</article>
{% endblock %}