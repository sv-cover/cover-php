<!DOCTYPE html>
<html>
	<head>
		<title>Cover</title>
		<style>
		html, body {
			margin: 0;
			overflow: hidden;
			font: 24px/32px sans-serif;
			cursor: none;
		}

		h1, h2, h3 {
			color: #C60C30;
		}

		h1 {
			text-shadow:
				-1px -1px 0 #fff,
				1px -1px 0 #fff,
				-1px 1px 0 #fff,
				1px 1px 0 #fff;
		}

		figure {
			margin: 1px;
		}

		.slide {
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			background: white;

			/*transition: all 0.8s ease;*/
		}

		.slide {
			-webkit-transform: translate(-150%, 0);
			-moz-transform: translate(-150%, 0);
			transform: translate(-150%, 0);
		}

		.slide.current {
			-webkit-transform: translate(0, 0);
			-moz-transform: translate(0, 0);
			transform: translate(0, 0);
		}

		.slide.current + .slide {
			-webkit-transform: translate(150%, 0);
			-moz-transform: translate(150%, 0);
			transform: translate(150%, 0);
		}

		.slide .collage h1,
		.slide .maikel h1 {
			position: absolute;
			top: 0;
			left: 20px;
			z-index: 10;
		}

		.slide .collage ul {
			margin: 0;
			padding: 0;
			list-style: none;
		}

		.slide .collage .foto {
			display: block;
			float: left;
			overflow: hidden;
		}

		.slide .agenda .agenda-item {
			clear: both;
			text-align: right;
			font: 30px/60px sans-serif;
		}

		.slide .agenda {
			padding: 0 40px;
		}

		.slide .agenda h3 {
			float: left;
			margin:0;
			padding: 0;
			display: inline-block;
		}

		</style>
	</head>
	<body>
		<div class="slides-container">
			<?php foreach ($slides as $slide => $options): ?>
			<div class="slide"
				data-url="scherm.php?slide=<?=$slide?>"
				data-time="20"></div>
			<?php endforeach ?>
		</div>
		<script src="<?=get_theme_data('views/scherm/scherm.js')?>"></script>
		<script>
			var slides = document.getElementsByClassName('slide');

			var currentETag = null;

			function checkETag(request)
			{
				var etag = request.getResponseHeader('X-Scherm-ETag');

				if (etag === null)
					return;

				if (currentETag === null)
					return currentETag = etag;

				if (currentETag != etag)
					document.location.reload();
			}

			function load_slide(slide)
			{
				var request = new XMLHttpRequest();
				request.open('GET', slide.getAttribute('data-url'), true);
				request.onreadystatechange = function() {
					if (request.readyState == 4) {
						checkETag(request);

						slide.innerHTML = request.responseText;

						// Evaluate all the JavaScript code blocks
						Array.prototype.forEach.call(
							slide.querySelectorAll('script'),
							function(script) {
								new Function(script.innerHTML).call(slide);
							});
					}
				};
				request.send();
			}

			function delay_load_slide(slide, delay)
			{
				setTimeout(function() { load_slide(slide); }, delay);
			}

			function next_slide()
			{
				for (var i = 0; i < slides.length; ++i)
				{
					// Vind de huidige slide
					if (!slides[i].classList.contains('current'))
						continue;

					var next = (i + 1) % slides.length;
					
					// en maak de volgende slide de huidige slide :D
					slides[i].classList.remove('current');
					slides[next].classList.add('current');

					// en laad vast de slide daarna
					delay_load_slide(slides[(i + 2) % slides.length], 1000);

					// en plan vast de volgende slide
					queue_next_slide(slides[i].getAttribute('data-time'));

					// Klaar!
					return;
				}
			}

			function queue_next_slide(timeout)
			{
				if (window.next_slide_timer)
					clearTimeout(window.next_slide_timer);

				if (!timeout)
					timeout = 20;

				window.next_slide_timer = setTimeout(next_slide, parseInt(timeout, 10) * 1000);
			}

			function layout_photos(slide)
			{
				var elements = slide.querySelectorAll('.foto');
				var photos = [];

				for (var i = 0; i < elements.length; ++i)
				{
					elements[i].querySelector('img').onload = function() {
						photos.push(new Photo(this.parentNode.parentNode));

						// Are we done yet?
						if (elements.length == photos.length)
							setTimeout(function() {
								order_photos(photos, window.innerWidth, parseInt(window.innerHeight / 2));
							}, 10);
					};
				}
			}

			function scroll_slide(slide)
			{
				var container = slide.querySelector('ul');
				var diff = container.scrollHeight - window.innerHeight;
				container.style.webkitTransition = '-webkit-transform 19s linear';
				container.style.webkitTransform = 'translate(0, -' + Math.max(diff, 0) + 'px)';
				container.style.mozTransition = '-moz-transform 19s linear';
				container.style.mozTransform = 'translate(0, -' + Math.max(diff, 0) + 'px)';
				container.style.transition = 'transform 19s linear';
				container.style.transform = 'translate(0, -' + Math.max(diff, 0) + 'px)';
			}

			function reset_scroll_slide(slide)
			{
				var container = slide.querySelector('ul');
				container.style.webkitTransition = 'none';
				container.style.webkitTransform = 'translate(0, 0)';
				container.style.mozTransition = 'none';
				container.style.mozTransform = 'translate(0, 0)';
				container.style.transition = 'none';
				container.style.transform = 'translate(0, 0)';
			}

			Array.prototype.forEach.call(slides, load_slide);
			// setInterval(next_slide, 20000);

			slides[0].classList.add('current');
			queue_next_slide(slides[0].getAttribute('data-time'));

			document.addEventListener('keydown', function(e) {
				if (e.keyCode != 39)
					return;

				next_slide();
				e.preventDefault();
			});
		</script>
	</body>
</html>