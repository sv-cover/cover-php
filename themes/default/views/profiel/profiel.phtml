<?php
$personal_fields = [
	[	
		'label' => __('Naam'),
		'name' => 'naam',
		'read_only' => true
	],
	[
		'label' => __('Geboortedatum'),
		'name' => 'geboortedatum',
		'data' => [
			'geboortedatum' => format_date($iter->get('geboortedatum'))
		],
		'read_only' => true
	],
	[
		'label' => __('Beginjaar'),
		'name' => 'beginjaar',
		'read_only' => true
	],
	[
		'label' => __('Adres'),
		'name' => 'adres'
	],
	[
		'label' => __('Postcode'),
		'name' => 'postcode'
	],
	[
		'label' => __('Woonplaats'),
		'name' => 'woonplaats'
	],
	[
		'label' => __('Telefoonnummer'),
		'name' => 'telefoonnummer'
	],
	[
		'label' => __('E-Mail adres'),
		'name' => 'email'
	]
];
?>
<h1><?= sprintf(__('Profiel van %s'), markup_format_text(member_full_name($iter, false, false))) ?></h1>
<div class="messageBox clearfix">

	<?php if (isset($errors) && count($errors) > 0): ?>
	<div class="textCenter error-section">
		<p><span class="error"><?= __('Niet alle velden zijn goed ingevuld') ?></span></p>
		
		<?php if (isset($error_message)): ?>
		<p><?= str_replace("\n", "<br>\n", $error_message) ?></p>
		<?php endif ?>
	</div>
	<?php endif ?>

	<div class="tab-container">
		<div class="tab-sidebar">
			<?php $this->render_partial('profile_widget', compact('iter')) ?>
			<ul class="nav-tabs vertical">
				<li class="active"><a href="#public"><?=markup_format_text(member_full_name($iter, false, false)) ?></a>
				<?php if ($this->member_write_permission($iter)): ?>
				<li><a href="#personal"><?=__('Almanakgegevens')?></a></li>
				<li><a href="#profile"><?=__('Website')?></a></li>
				<li><a href="#privacy"><?=__('Privacy')?></a></li>
				<li><a href="#mailinglists"><?=__('Mailinglijsten')?></a></li>
				<li><a href="#sessions"><?=__('Sessies')?></a></li>
				<?php if ($this->is_current_member($iter->get('lidid')) && get_config_value('enable_facebook_rsvp', false)): ?>
				<li><a href="#facebook"><?=__('Facebook')?></a></li>
				<?php endif ?>
				<?php endif ?>
			</ul>
		</div>

		<div class="tab-content">
			<div id="public" class="tab-pane active">
				<?php $this->render_partial('public', compact('model', 'iter', 'personal_fields')) ?>
			</div>
			
			<?php if ($this->member_write_permission($iter)): ?>
			<div id="personal" class="tab-pane">
				<?php $this->render_partial('personal', compact('iter', 'errors', 'personal_fields')) ?>

				<?php if (member_in_commissie(COMMISSIE_BESTUUR) || member_in_commissie(COMMISSIE_KANDIBESTUUR)): ?>
					<?php $this->render_partial('visibility', compact('iter')); ?>
				<?php endif ?>
			</div>
			
			<div id="profile" class="tab-pane">
				<?php $this->render_partial('profile', compact('model', 'iter', 'errors')) ?>
				<?php if ($this->member_write_permission($iter)): ?>
					<?php $this->render_partial('password', compact('iter', 'errors')) ?>
				<?php endif ?>
			</div>
			
			<div id="privacy" class="tab-pane">
				<?php $this->render_partial('privacy', compact('model', 'iter')) ?>

				<a href="fotoboek.php?book=member_<?=$iter->get_id()?>"><?=markup_format_text(sprintf(__('Foto\'s van %s'), member_full_name($iter, false, false))) ?></a>
			</div>
			<?php endif ?>
			
			<?php if ($this->is_current_member($iter) || member_in_commissie(COMMISSIE_EASY)): ?>
			<div id="mailinglists" class="tab-pane">
				<?php $this->render_partial('mailinglists', compact('iter')) ?>
			</div>
	
			<div id="sessions" class="tab-pane">
				<?php $this->render_partial('sessions', compact('iter')) ?>
			</div>
			<?php endif ?>

			<?php if ($this->is_current_member($iter->get('lidid')) && get_config_value('enable_facebook_rsvp', false)): ?>
			<div id="facebook" class="tab-pane">
				<?php $this->render_partial('facebook', compact('iter')) ?>
			</div>
			<?php endif ?>
		</div>
	</div>
</div>

<script>
jQuery(function($) {
	// Hide all tabs
	function switchToTab(hash) {
		var $tab = $(hash);

		// Do nothing if we can't find the tab
		if (!$tab.length)
			return;

		// Hide all other tabs
		$('.tab-pane').hide();

		// Show this tab
		$tab.show();

		// Mark all other tabs as inactive
		$('.nav-tabs li').removeClass('active');

		// Except for this one
		$('.nav-tabs').find('a[href=#' + $tab.attr('id') + ']').closest('li').addClass('active');
	};

	$('.tab-pane:not(.active)').hide();

	$('.nav-tabs').on('click', 'a[href^=#]', function(e) {
		e.preventDefault();
		window.location.hash = e.target.hash;
		switchToTab(e.target.hash);
	});

	if (window.location.hash)
		switchToTab(window.location.hash);

	$(window).on('hashchange', function() {
		switchToTab(window.location.hash);
	});
})
</script>