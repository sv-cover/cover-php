{% extends '@layout/layout.twig' %}

{% block title (form.has_id ? __('Wijzig formulier') : __('Formulier toevoegen')) ~ ' :: ' ~ parent() %}

{% block content %}
<div class="pageheading">
	<div class="controls inline">
		{% if form.has_id and user_can_read form %}
			<a href="{{ controller.link({'view': 'create_entry', 'form': form.id}) }}" class="edit-link">{{ __('Bekijk formulier') }}</a>
			<a href="{{ controller.link({'view': 'list_entries', 'form': form.id}) }}" class="download-link">{{ __('Bekijk inschrijvingen') }}</a>
		{% endif %}
	</div>
	<h1>{{ form.has_id ? __('Formulier wijzigen') : __('Formulier maken') }}</h1>
</div>
<div class="messageBox">
	<form method="post" class="vertical-form" action="{{ form.has_id ? controller.link({'view': 'update_form', 'form': form.id}) : controller.link({'view': 'create_form'}) }}">
		{% if form.has_id %}
			{{ html_nonce('update_form', form) }}
		{% else %}
			{{ html_nonce('create_form') }}
		{% endif %}

		<div>
			{{ html_label(__('Commissie'), 'committee_id', errors=errors, required=true) }}
			{{ html_select_field('committee_id', view.available_committees, form, required=true) }}
		</div>

		<div>
			{{ html_label(__('Activiteit'), 'agenda_id', errors=errors) }}
			{{ html_select_field('agenda_id', view.available_activitees, form) }}
			<p>{{ __('Als je een activiteit kiest wordt het formulier bij het agendapunt getoond.') }}</p>
		</div>

		<fieldset>
			<legend>{{ __('Inschrijfperiode') }}</legend>
			<div>
				{{ html_label(__('Openingsdatum'), 'open_on', errors=errors)  }}
				{{ html_input_datetime('open_on', form, errors=errors) }}
				<p>{{ __('Het formulier gaat open op deze datum. Let op dat je het formulier niet al open zet terwijl je het nog aan het maken bent.') }}</p>
			</div>
			<div>
				{{ html_label(__('Sluitdatum'), 'closed_on', errors=errors)  }}
				{{ html_input_datetime('closed_on', form, errors=errors) }}
				<p>{{ __('Als je nog geen sluitdatum hebt mag je dit veld leeg laten.') }}</p>
			</div>
		</fieldset>

		{% if not form.has_id %}
			<div>
				{{ html_label(__('Sjabloon'), 'template', errors=errors)  }}
				{{ html_select_field('template', controller.available_templates, null, errors=errors) }}
				<p>{{ __('Kies een sjabloon als je alvast een aantal standaard velden wil toevoegen.') }}
			</div>			
		{% endif %}

		<div class="controls">
			<button class="button" type="submit">{{ form.has_id() ? __('Wijzig formulier') : __('Maak formulier') }}</button>
			{% if form.has_id and user_can_delete form %}
				<a href="{{ controller.link({view: 'delete_form', form: form.id}) }}">{{ __('Verwijder formulierâ€¦') }}</a>
			{% endif %}
		</div>
	</form>
</div>

{% if form.has_id %}
<div class="messageBox">
	<form action="{{ controller.link({view: 'create_form_field', form: form.id}) }}" class="inline-form" method="post">
		{{ html_nonce('create_form_field', form) }}
		<p>{{ __('Voeg een nieuw %s veld toe aan dit formulier')|e('html')|format(html_select_field('field_type', view.available_field_types, null, required=true))|raw }} <button type="submit" class="button">{{ __('Voeg veld toe') }}</button></p>
	</form>
	
	<div class="form-fields" data-sortable-action="{{ controller.link({view: 'update_form_field_order', form: form.id}) }}">
	{% for field in form.fields %}
		<div class="form-field" id="form-field-{{field.id}}" data-sortable-id="{{ field.id }}">
			<div class="sortable-drag-handle" title="Drag me to reorder"></div>
			<form id="field-{{field.id}}-update" action="{{ controller.link({view: 'update_form_field', form: form.id, field: field.id}) }}" method="post" data-submit-on-change="{&quot;action&quot;:&quot;update&quot;}">
				{{ html_nonce('update_form_field', form, field) }}
				{{ field.render_configuration(view, errors.namespace(field.id))|raw }}
			</form>
			<form id="field-{{field.id}}-delete" action="{{ controller.link({view: 'delete_form_field', form: form.id, field: field.id}) }}" data-partial-selector="#form-field-{{field.id}}" data-placement-selector="#form-field-{{field.id}}" method="post">
				{{ html_nonce('delete_form_field', form, field) }}
			</form>
			<div class="controls">
				<button type="submit" class="button hide-if-submit-on-change" form="field-{{field.id}}-update">{{ __('Wijzig veld') }}</button>
				<button type="submit" class="button" form="field-{{field.id}}-delete">{{ __('Verwijder veld') }}</button>
			</div>
		</div>
	{% endfor %}
	</div>
</div>
{% endif %}

{% endblock %}
